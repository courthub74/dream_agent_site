<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dream Agent</title>
  <meta name="description" content="Dream Agent curates machine hallucinations—surreal, symbolic, anonymous. Enter the realm." />
  <meta property="og:title" content="Dream Agent" />
  <meta property="og:description" content="Surreal symbolism from machine dreams." />
  <meta property="og:image" content="/img/og-cover.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Perf: fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500&display=swap" rel="stylesheet">
  <link rel="preload" as="image" href="./img/hero_logo.png" />

  <!-- Tailwind (CDN for dev; build for prod) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    :root {
      --ink-100: rgba(255,255,255,1);
      --ink-90:  rgba(255,255,255,.9);
      --ink-78:  rgba(255,255,255,.78);
      --ink-70:  rgba(255,255,255,.70);
      --ink-65:  rgba(255,255,255,.65);
      --ink-55:  rgba(255,255,255,.55);
      --ink-45:  rgba(255,255,255,.45);
      --ink-30:  rgba(255,255,255,.30);
      --card-gap: .75rem; /* desktop gap */
      --content-max: 72rem; /* desktop container */
      --content-pad: 1rem;
      /* For the Arrows */
      --cc-offset: -1.9rem;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    html, body { height: 100%; color: beige; scroll-behavior: smooth; }

    body {
      min-height: 100%;
      display: flex;
      flex-direction: column;
      background-image: linear-gradient(rgba(0, 86, 184, 0.375), rgba(0, 86, 184, 0.512)), url('./img/larger_about_background.png');
      background-position: center; background-repeat: no-repeat; background-size: cover; background-attachment: fixed;
    }

    h1, h2, h3, h4, #title, .about-link, .overlay-text, .mobile_about_header, .mobile_about_collections_header, #cta {
      font-family: 'Playfair Display', serif;
    }

    main { flex: 1 0 auto; }

    /* HERO */
    .mobile_hero { height: 100vh; background: center/cover no-repeat url('./img/plain_background_bigger.png'); }
    .mobile_hero_container { display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 6rem; height: 100%; }
    .hero_phrase { font-size: 1.5rem; text-align: center; }
    .about-link { background:#0057B8; color: white; padding: 10px 20px; border-radius: 6px; font-size: 1rem; text-decoration: none; transition: background-color .3s ease, transform .3s ease; }

    /* ABOUT */
    section.mobile_about { width: 100%; color: white; background:
      linear-gradient(rgba(0, 86, 184, 0.375), rgba(0, 86, 184, 0.512)),
      url('./img/even_larger_about_background.png') center/cover no-repeat; }
    .mobile_about_container { max-width: var(--content-max); margin-inline: auto; padding-inline: var(--content-pad); }
    .mobile_about_header { text-align: left; font-size: 1.5rem; font-weight: 700; padding-left: .25rem; margin-top: 1rem; }
    .mobile_about_paragraph { line-height: 1.7; margin: 1rem 0 2rem; }

    /* COLLECTIONS */
    #collections { max-width: var(--content-max); margin-inline: auto; padding-inline: var(--content-pad); }
    .collections-title { margin: .25rem 0 0.5rem; font-size: 1.3rem; }

    /* Card base */
    #collections a.group { position: relative; display: block; border-radius: 16px; overflow: hidden; background: rgba(255,255,255,.05); backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,.10); transition: transform .15s ease, box-shadow .2s ease; height: 360px; }
    #collections a.group:hover { transform: translateY(-2px); }
    #collections a.group img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
    #collections a.group .shade { position: absolute; inset: 0; background: rgba(0,0,0,.4); transition: background .2s ease; }
    #collections a.group:hover .shade { background: rgba(0,0,0,.3); }
    #collections a.group .copy { position: relative; z-index: 1; height: 100%; display: flex; flex-direction: column; justify-content: end; padding: 1.25rem; }

    /* Text scale */
    .collection-title { font-weight: 400; font-size: clamp(15px, 1vw, 18px); line-height: 1.25; color: rgba(255,255,255,.95); margin-bottom: .25rem; letter-spacing: .2px; }
    .collection-description { font-family: 'Times New Roman', Times, serif; font-weight: 400; font-size: clamp(12px, .9vw, 14px); line-height: 1.35; color: var(--ink-78); margin-bottom: .4rem; }
    .works-include { font-family: 'Times New Roman', Times, serif; font-size: clamp(11px, .8vw, 13px); font-weight: 500; text-transform: uppercase; letter-spacing: .5px; color: var(--ink-70); margin-bottom: .15rem; }
    .flashing-title { font-family: 'Times New Roman', Times, serif; font-size: clamp(12px, 1vw, 15px); font-weight: 400; color: var(--ink-70); }

    /* Hairline divider (fade on right only) */
    #collections a.group .worklist { position: relative; margin-top: .35rem; padding-top: .45rem; }
    #collections a.group .worklist::before { content: ""; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(to right, rgba(255,255,255,.25) 0%, rgba(255,255,255,.25) 80%, rgba(255,255,255,0) 100% ); opacity: .6; pointer-events: none; }

    /* Reveal cards */
    .reveal-card { opacity: 0; transform: translateY(10px); transition: opacity .8s ease, transform .8s ease; will-change: transform, opacity; }
    .reveal-card.visible { opacity: 1; transform: none; }
    .reveal-left { transform: translateX(-28px) translateY(10px); }
    .reveal-right { transform: translateX(28px) translateY(10px); }
    @media (prefers-reduced-motion: reduce) { .reveal-card, .reveal-left, .reveal-right { transition: none; transform: none; opacity: 1; } }

    /* Desktop carousel shell */
    #collections .collections-carousel { position: relative; }
    #collections .cc-viewport { position: relative; overflow: hidden; width: 100%; outline: none; }
    #collections .cc-track { display: flex; flex-wrap: nowrap; gap: var(--card-gap); will-change: transform; }
    #collections .cc-controls {
      position: absolute;
      top: var(--cc-offset);   /* was -2.5rem */
      right: 0;
      transform: translateY(-100%);
      display: flex;
      gap: .75rem;
      z-index: 10;
      pointer-events: none;
    }
    /* #collections .cc-controls { position: absolute; top: -2.5rem; right: 0; transform: translateY(-100%); display: flex; gap: .75rem; z-index: 10; pointer-events: none; } */
    #collections .cc-arrow { pointer-events: auto; width: 48px; height: 48px; border-radius: 999px; display: grid; place-items: center; cursor: pointer; background: rgba(255,255,255,.14); border: 1px solid rgba(255,255,255,.28); backdrop-filter: blur(8px); box-shadow: 0 10px 28px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.08); transition: transform .15s ease, background-color .15s ease, box-shadow .2s ease, opacity .2s ease; opacity: .95; }
    #collections .cc-arrow:hover { background: rgba(255,255,255,.20); transform: translateY(-1px); box-shadow: 0 14px 32px rgba(0,0,0,.32), inset 0 0 0 1px rgba(255,255,255,.12); }
    #collections .cc-arrow:active { transform: translateY(0) scale(.98); }
    #collections .cc-arrow:disabled { opacity: .38; cursor: default; }
    #collections .cc-arrow svg { width: 22px; height: 22px; stroke: #EAF2FF; stroke-width: 2.25; fill: none; }

    /* Dots */
    #collections .cc-dots { display: flex; justify-content: center; align-items: center; gap: .9rem; margin-top: 1.25rem; min-height: 18px; user-select: none; }
    #collections .cc-dot { position: relative; width: 12px; height: 12px; flex: 0 0 12px; border-radius: 999px; border: 2px solid var(--ink-45); background: transparent; opacity: .75; cursor: pointer; transition: opacity .15s linear, background-color .15s linear, border-color .15s linear; }
    #collections .cc-dot:hover { opacity: .95; }
    #collections .cc-dot.is-active { background: var(--ink-90); border-color: var(--ink-100); opacity: 1; }
    #collections .cc-dot::after { content: ""; position: absolute; inset: -6px; border-radius: inherit; pointer-events: none; opacity: 0; transition: opacity .2s ease; box-shadow: 0 0 0 4px rgba(255,255,255,.12); }
    #collections .cc-dot.is-active::after { opacity: 1; }

    /* Footer */
    footer { text-align: center; color: #EAEFF7; background: linear-gradient(to bottom, #114C92, #022A54); position: relative; margin-top: auto; border-radius: 5px; padding-block: 2rem; border-top: 1px solid rgba(255,255,255,0.2); }

    /* Mobile tweaks */
    @media (max-width: 480px) {
      #collections a.group { height: clamp(220px, 42vh, 320px); }
    }

    /* Tablet landscape section height tweaks */
    @media (min-width: 600px) and (max-width: 1024px) {
      body { background-attachment: fixed; }
      .mobile_hero { height: 140vh; }
      .mobile_hero_container { margin-top: -60px; gap: 3rem; }
      .collections-title { margin-top: -2rem; font-size: 1.2rem; }
    }

    /* Desktop layout */
    @media (min-width: 1025px) {
      #collections .cc-track > a.group { flex: 0 0 calc((100% - (2 * var(--card-gap))) / 3); max-width: calc((100% - (2 * var(--card-gap))) / 3); }
      /* Desktop: show full About paragraph, hide teaser */
      .mobile_about_portion { display: none !important; }
      .mobile_about_paragraph { display: block !important; }
    }

    /* Landscape phones & tablets: smaller/shorter collection cards */
    @media (orientation: landscape) and (max-width: 1024px) {
      :root {
        --card-gap: .55rem;           /* tighten spacing a bit */
      }

      #collections a.group {
        /* shorter cards; scales with viewport height but capped */
        height: clamp(180px, 38vh, 260px);
      }

      /* slightly tighter padding + type so more fits on screen */
      #collections a.group .copy { padding: 0.9rem; }
      .collection-title        { font-size: clamp(14px, .95vw, 16px); }
      .collection-description  { font-size: clamp(11px, .85vw, 13px); }
      .works-include           { font-size: clamp(10px, .75vw, 12px); }
      .flashing-title          { font-size: clamp(11px, .9vw, 13px); }
    }

    /* Ultra-short landscapes (e.g., 360–420px tall): make them even shorter */
    @media (orientation: landscape) and (max-height: 420px) {
      #collections a.group { height: clamp(160px, 34vh, 220px); }
    }


    /* generic fade-in used by hero and anywhere with .fade-in */
    .fade-in { opacity: 0; transform: translateY(10px); transition: opacity .8s ease, transform .8s ease; }
    .fade-in.visible { opacity: 1; transform: none; }

    /* Glowing Enter the Realm Button */
    .about-link {
    position: relative;
    isolation: isolate;                 /* keeps glow behind the button */
    box-shadow: 0 2px 10px rgba(0,0,0,.18);
  }
  .about-link::after {
    content: "";
    position: absolute;
    inset: -6px;                        /* glow spread */
    border-radius: inherit;
    background: radial-gradient(120% 120% at 50% 50%,
                rgba(0, 87, 184, .55), rgba(0, 87, 184, 0) 60%);
    filter: blur(14px);
    opacity: 0;
    transition: opacity .2s ease;
    z-index: -1;                        /* glow behind */
  }
  .about-link:hover {
    transform: translateY(-1px);
    box-shadow:
      0 10px 26px rgba(0,0,0,.28),
      0 0 0 1px rgba(255,255,255,.20),
      0 0 24px rgba(0,87,184,.75),
      0 0 48px rgba(0,87,184,.45);
  }
  .about-link:hover::after { opacity: 1; }
  .about-link:active { transform: translateY(0); }
  .about-link:focus-visible { outline: 2px solid rgba(255,255,255,.65); outline-offset: 3px; }
    
  </style>
</head>
<body>
  <main>
    <!-- HERO -->
    <section id="mobile_hero" class="mobile_hero">
      <div class="mobile_hero_container">
        <img src="./img/hero_logo.png" class="hero_logo" width="200" height="200" alt="Dream Agent logo" />
        <p class="hero_phrase hero-animate fade-in">Machine dreams in Metaphor</p>
        <a class="about-link hero-animate fade-in" id="cta" href="#mobile_about">Enter the Realm</a>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="mobile_about" class="mobile_about">
      <div class="mobile_about_container py-8">
        <h1 class="mobile_about_header">Who is Dream Agent?</h1>

        <!-- short intro + read more -->
        <p class="mobile_about_portion mt-2">Emerging from the shadows of the digital realm, Dream Agent exists not as a face, but as a surrealist force. A curator of machine hallucinations who... <button class="read_more"><b>Read More</b></button></p>

        <p class="mobile_about_paragraph hidden">Emerging from the shadows of the digital realm, Dream Agent exists not as a face, but as a surrealist force. A curator of machine hallucinations who paints with prompts and sculpts meaning from code. Operating anonymously, they transform AI-generated art into deeply symbolic worlds. Each piece is less a picture and more a portal—one that invites viewers to question, decode, and reflect.</p>

        <!-- Divider -->
        <div id="mobile-about-divider" class="w-40 sm:w-56 h-[2px] bg-white/30 mx-auto my-6 sm:my-10 lg:my-12 rounded-full shadow-[0_0_8px_rgba(255,255,255,0.4)] opacity-0 scale-x-0 transition-transform duration-700 ease-out"></div>

        <!-- COLLECTIONS -->
        <section id="collections" class="mx-auto py-10 space-y-8">
          <h2 class="collections-title font-semibold mb-2">Explore the Collections</h2>

          <!-- SYMBOLS IN MOTION -->
          <a href="/collections/symbols-in-motion" class="group reveal-card reveal-left">
            <img src="./img/collections/Symbols in Motion.png" alt="Symbols in Motion" width="1200" height="800" />
            <div class="shade"></div>
            <div class="copy">
              <h3 class="text-lg sm:text-xl font-normal mb-1 collection-title">Symbols in Motion</h3>
              <p class="text-sm sm:text-base collection-description">Recurring signs caught in perpetual drift.</p>
              <ul class="worklist mt-2 space-y-1 text-sm text-neutral-300">
                <li class="font-semibold works-include">Works include:</li>
                <li id="symbol-title" class="flashing-title" aria-live="polite"></li>
              </ul>
            </div>
          </a>

          <!-- SIGNALS & ASCENSIONS -->
          <a href="/collections/signals-ascensions" class="group reveal-card reveal-left">
            <img src="./img/collections/Signals and Ascensions.png" alt="Signals &amp; Ascensions" width="1200" height="800" />
            <div class="shade"></div>
            <div class="copy">
              <h3 class="text-lg sm:text-xl font-normal mb-1 collection-title">Signals &amp; Ascensions</h3>
              <p class="text-sm sm:text-base collection-description">Messages in transit between epochs.</p>
              <ul class="worklist mt-2 space-y-1 text-sm text-neutral-300">
                <li class="font-semibold works-include">Works include:</li>
                <li id="signal-title" class="flashing-title" aria-live="polite"></li>
              </ul>
            </div>
          </a>

          <!-- WAR & FEAST -->
          <a href="/collections/war-feast" class="group reveal-card reveal-left">
            <img src="./img/collections/Dominion Archives.png" alt="War &amp; Feast" width="1200" height="800" />
            <div class="shade"></div>
            <div class="copy">
              <h3 class="text-lg sm:text-xl font-normal mb-1 collection-title">War &amp; Feast</h3>
              <p class="text-sm sm:text-base collection-description">Conflict, appetite, and ceremonial excess.</p>
              <ul class="worklist mt-2 space-y-1 text-sm text-neutral-300">
                <li class="font-semibold works-include">Works include:</li>
                <li id="war-title" class="flashing-title" aria-live="polite"></li>
              </ul>
            </div>
          </a>

          <!-- INDUSTRIAL MYTHS -->
          <a href="/collections/industrial-myths" class="group reveal-card reveal-left">
            <img src="./img/collections/Symbols in Motion.png" alt="Industrial Myths" width="1200" height="800" />
            <div class="shade"></div>
            <div class="copy">
              <h3 class="text-lg sm:text-xl font-normal mb-1 collection-title">Industrial Myths</h3>
              <p class="text-sm sm:text-base collection-description">A surreal meditation on machines, labor, and digital systems reimagined.</p>
              <ul class="worklist mt-2 space-y-1 text-sm text-neutral-300">
                <li class="font-semibold works-include">Works include:</li>
                <li id="industrial-title" class="flashing-title" aria-live="polite"></li>
              </ul>
            </div>
          </a>

          <!-- THE DIGITAL UNCONSCIOUS -->
          <a href="/collections/digital-unconscious" class="group reveal-card reveal-left">
            <img src="./img/collections/Signals and Ascensions.png" alt="The Digital Unconscious" width="1200" height="800" />
            <div class="shade"></div>
            <div class="copy">
              <h3 class="text-lg sm:text-xl font-normal mb-1 collection-title">The Digital Unconscious</h3>
              <p class="text-sm sm:text-base collection-description">Where AI dreams and data remembers.</p>
              <ul class="worklist mt-2 space-y-1 text-sm text-neutral-300">
                <li class="font-semibold works-include">Works include:</li>
                <li id="digital-title" class="flashing-title" aria-live="polite"></li>
              </ul>
            </div>
          </a>

          <!-- THE DOMINION ARCHIVE -->
          <a href="/collections/dominion-archive" class="group reveal-card reveal-left">
            <img src="./img/collections/Dominion Archives.png" alt="The Dominion Archive" width="1200" height="800" />
            <div class="shade"></div>
            <div class="copy">
              <h3 class="text-lg sm:text-xl font-normal mb-1 collection-title">The Dominion Archive</h3>
              <p class="text-sm sm:text-base collection-description">Power recorded, repackaged, ritualized.</p>
              <ul class="worklist mt-2 space-y-1 text-sm text-neutral-300">
                <li class="font-semibold works-include">Works include:</li>
                <li id="dominion-title" class="flashing-title" aria-live="polite"></li>
              </ul>
            </div>
          </a>
        </section>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer>
    <div class="mobile_about_container py-6 sm:py-4">
      <div class="flex flex-col sm:flex-row items-center w-full sm:justify-between gap-4">
        <div class="sm:flex sm:flex-col sm:gap-4 items-center">
          <p class="hidden sm:block text-sm text-center">No face, No fame, just the vision</p>
          <div class="logo flex items-center gap-5 mb-2 p-1">
            <img src="./img/logos/DreamAgent Logo 11.png" alt="Dream Agent logo" class="w-[50px] h-[50px] rounded-full border border-white/10" width="50" height="50" />
            <a href="#" aria-label="Twitter"><img src="./img/round_logos/twitter_black_circle.png" alt="Twitter" class="w-[40px] h-[40px] cursor-pointer" width="40" height="40" /></a>
            <a href="#" aria-label="Instagram"><img src="./img/round_logos/instagram_red_circle.png" alt="Instagram" class="w-[42px] h-[42px] cursor-pointer" width="42" height="42" /></a>
            <a href="#" aria-label="Bluesky"><img src="./img/round_logos/bluesky_liteblue_circle.png" alt="Bluesky" class="w-[42px] h-[42px] cursor-pointer" width="42" height="42" /></a>
            <a href="#" aria-label="TikTok"><img src="./img/round_logos/tiktok_black_circle.png" alt="TikTok" class="w-[42px] h-[42px] cursor-pointer" width="42" height="42" /></a>
          </div>
        </div>

        <div class="hidden sm:flex sm:flex-col sm:items-center sm:gap-4">
          <p class="text-sm text-center">For NFTs:</p>
          <div class="nft_icons flex items-center justify-center gap-5 p-1">
            <a href="#" aria-label="XRP Café"><img src="./img/round_logos/xrpcafe_circle.png" alt="XRP Café" class="w-[42px] h-[42px] cursor-pointer" width="42" height="42" /></a>
            <a href="#" aria-label="OpenSea"><img src="./img/round_logos/opensea_circle.png" alt="OpenSea" class="w-[42px] h-[42px] cursor-pointer" width="42" height="42" /></a>
            <a href="#" aria-label="SuperRare"><img src="./img/round_logos/superrare_circle.png" alt="SuperRare" class="w-[42px] h-[42px] cursor-pointer" width="42" height="42" /></a>
          </div>
        </div>
      </div>

      <p class="mt-4 text-xs text-[#cccccc]" id="copyright">&copy; 2023 Dream Agent. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // Fade-ins on hero
    // gsap.to(".hero_phrase", { opacity: 1, y: 0, duration: 1, delay: 1.2 });
    // gsap.to("#cta", { opacity: 1, y: 0, duration: 1, delay: 1.5 });

    // CSS-driven fade-ins for hero + anything with .fade-in
    const fadeIns = document.querySelectorAll('.fade-in');
    const fadeInObserver = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (!entry.isIntersecting) return;

        // stagger hero a touch, CTA a bit more
        let delay = 0;
        if (entry.target.classList.contains('hero_phrase')) delay = 700;   // ~0.7s
        if (entry.target.id === 'cta') delay = 1000;                       // ~1.0s

        setTimeout(() => {
          entry.target.classList.add('visible');
        }, delay);

        fadeInObserver.unobserve(entry.target);
      });
    }, { threshold: 0.1 });

    fadeIns.forEach(el => fadeInObserver.observe(el));


    // Parallax (optional)
    document.addEventListener('scroll', () => {
      document.querySelectorAll('.parallax').forEach(el => {
        const offset = window.scrollY * 0.3;
        el.style.transform = `translateY(${offset}px)`;
      });
    });

    // Divider reveal
    (function(){
      const el = document.getElementById('mobile-about-divider');
      if (!el) return;
      const io = new IntersectionObserver(([entry]) => {
        if (entry.isIntersecting) {
          el.classList.remove('opacity-0', 'scale-x-0');
          el.classList.add('opacity-100', 'scale-x-100', 'animate-pulse');
          io.disconnect();
        }
      }, { threshold: .5 });
      io.observe(el);
    })();

    // Read More / Less (progressive)
    (function(){
      const shortP = document.querySelector('.mobile_about_portion');
      const fullP  = document.querySelector('.mobile_about_paragraph');
      const btn    = shortP?.querySelector('button');
      if (!shortP || !fullP || !btn) return;
      btn.addEventListener('click', () => {
        shortP.classList.add('hidden');
        fullP.classList.remove('hidden');
        if (!fullP.querySelector('button')) {
          const lessBtn = document.createElement('button');
          lessBtn.innerHTML = '<b>Read Less</b>';
          lessBtn.addEventListener('click', () => {
            fullP.classList.add('hidden');
            shortP.classList.remove('hidden');
          });
          fullP.appendChild(lessBtn);
        }
      });
    })();

    // Reveal cards with GSAP (respects reduced motion)
    (function(){
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const cards = Array.from(document.querySelectorAll('#collections .reveal-card'));
      if (!cards.length) return;
      if (prefersReduced || typeof gsap === 'undefined') { cards.forEach(el => el.classList.add('visible')); return; }
      const io = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (!entry.isIntersecting) return;
          const el = entry.target; io.unobserve(el);
          const fromX = el.classList.contains('reveal-left') ? -28 : 28;
          gsap.fromTo(el, { opacity: 0, x: fromX, y: 10 }, { opacity: 1, x: 0, y: 0, duration: .85, ease: 'power2.out' });
        });
      }, { threshold: .22 });
      cards.forEach((el, i) => setTimeout(() => io.observe(el), i * 70));
    })();

    // Title rotators: start when visible, pause when hidden, honor reduced motion
    function makeRotator(el, titles, intervalMs = 3000){
      if (!el || !Array.isArray(titles) || !titles.length) return () => {};
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) { el.textContent = titles[0]; return () => {}; }
      let i = 0, id = null;
      const tick = () => { el.textContent = titles[i = (i + 1) % titles.length]; };
      const start = () => { if (!id) id = setInterval(tick, intervalMs); };
      const stop  = () => { if (id) clearInterval(id), id = null; };
      const io = new IntersectionObserver(([entry]) => entry.isIntersecting ? start() : stop(), { threshold: .2 });
      io.observe(el);
      el.textContent = titles[0]; start();
      return () => { stop(); io.disconnect(); };
    }

    // Initialize title rotators
    document.addEventListener('DOMContentLoaded', () => {
      makeRotator(document.getElementById('symbol-title'),    ["Hollywood Moderne","Sephardic Tango","Crypto Fish Tank","The Rusher, The Incrementer and..","Rinse and Repeat"], 3000);
      makeRotator(document.getElementById('signal-title'),    ["Revolutionary Balloon","The Magic of ’86","Bitcoin 2017","Hip Hop 1978","The Biblicals"], 3000);
      makeRotator(document.getElementById('war-title'),       ["Coeur of the Grapes","The Wine Wars","Some Things Were Meant to..."], 3000);
      makeRotator(document.getElementById('industrial-title'),["The Cursor of Fate","The Future of Industry","The Fear Room","The Great Divide"], 3000);
      makeRotator(document.getElementById('digital-title'),   ["Internet of the Old World","Internet of the Middle World","Internet of the New World","Prince Carl laying in front of the TV...."], 3000);
      makeRotator(document.getElementById('dominion-title'),  ["Bottling the Republic","Discovery of the Indigenous","The Refactoring Ritual","The Census Ritual","Etch the Empire"], 3000);
    });

    // Desktop carousel (finite, rightmost dot active)
    (function(){
      const mq = window.matchMedia('(min-width: 1025px)');
      const collections = document.querySelector('#collections');
      if (!collections) return;

      const cardSelector = ':scope > a.group';
      let shell = null, viewport = null, track = null, prevBtn = null, nextBtn = null, dotsWrap = null, dots = [];
      let cardsCache = []; let index = 0; let stepPx = 0; let slotsPerView = 1; let pages = 1; let ro = null;
      let rafId = 0, scrollIdleTimer = 0; const SCROLL_IDLE_MS = 140;

      function getGap(){ const cs = getComputedStyle(track); const g = parseFloat(cs.columnGap || cs.gap || 0); return isNaN(g) ? 0 : g; }
      function getCardWidth(){ const card = track?.querySelector('a.group'); return card ? card.getBoundingClientRect().width : 0; }
      function clamp(i){ return Math.max(0, Math.min(i, pages - 1)); }

      function measure(){
        const cardW = getCardWidth(); const gap = getGap(); stepPx = cardW + gap;
        const EPS = .01; const vw = viewport.clientWidth; slotsPerView = Math.max(1, Math.floor((vw + gap - EPS) / Math.max(stepPx, 1)));
        pages = Math.max(1, cardsCache.length - slotsPerView + 1);
      }

      function updateArrows(){ if (!prevBtn || !nextBtn) return; const hide = pages <= 1; prevBtn.style.display = hide ? 'none' : ''; nextBtn.style.display = hide ? 'none' : ''; prevBtn.disabled = index <= 0; nextBtn.disabled = index >= (pages - 1); }
      function activeDotIndex(){ const rightMost = Math.min(index + slotsPerView - 1, cardsCache.length - 1); return rightMost; }

      function updateDots(){ if (!dotsWrap || !dots.length) return; const a = activeDotIndex(); dots.forEach((d,i)=>{ const on = i === a; d.classList.toggle('is-active', on); d.setAttribute('aria-current', on ? 'true' : 'false'); }); }

      function buildDots(){
        if (!dotsWrap) return; dotsWrap.innerHTML = ''; dots = []; const count = cardsCache.length;
        if (count <= 1) { dotsWrap.style.display = 'none'; return; } dotsWrap.style.display = 'flex';
        for (let i=0; i<count; i++){
          const b = document.createElement('button'); b.type='button'; b.className='cc-dot'; b.setAttribute('aria-label',`Go to item ${i+1}`);
          b.addEventListener('click',()=>{ const firstIdx = clamp(i - (slotsPerView - 1)); goToIndex(firstIdx, true); });
          dotsWrap.appendChild(b); dots.push(b);
        }
        updateDots();
      }

      function goToIndex(i, smooth=true){ index = clamp(i); const left = index * stepPx; if (smooth && 'scrollTo' in viewport) viewport.scrollTo({left, behavior:'smooth'}); else viewport.scrollLeft = left; updateArrows(); updateDots(); }

      function onScroll(){ if (rafId) cancelAnimationFrame(rafId); rafId = requestAnimationFrame(()=>{ if (stepPx <= 0) return; const pending = clamp(Math.round(viewport.scrollLeft / stepPx)); updateArrows(); clearTimeout(scrollIdleTimer); scrollIdleTimer = setTimeout(()=>{ if (index !== pending) index = pending; updateDots(); }, SCROLL_IDLE_MS); }); }

      function enable(){ if (shell) return;
        const allCards = Array.from(collections.querySelectorAll(cardSelector));
        const seen = new Set();
        cardsCache = allCards.filter(a=>{ const key = a.getAttribute('href') || a.id || a.textContent.trim(); if (seen.has(key)) return false; seen.add(key); return true; });
        if (!cardsCache.length) return;

        shell = document.createElement('div'); shell.className='collections-carousel';
        viewport = document.createElement('div'); viewport.className='cc-viewport'; viewport.tabIndex = 0; // keyboard focus
        track = document.createElement('div'); track.className='cc-track';
        const controls = document.createElement('div'); controls.className='cc-controls';
        const mk = (cls, label, path) => { const b = document.createElement('button'); b.type='button'; b.className=`cc-arrow ${cls}`; b.setAttribute('aria-label', label); b.innerHTML = `<svg viewBox="0 0 24 24" aria-hidden="true"><path d="${path}"/></svg>`; return b; };
        prevBtn = mk('cc-prev','Previous','M15 5 L8 12 L15 19');
        nextBtn = mk('cc-next','Next','M9 5 L16 12 L9 19');
        controls.append(prevBtn, nextBtn);
        dotsWrap = document.createElement('div'); dotsWrap.className='cc-dots';

        viewport.appendChild(track); shell.append(viewport, controls, dotsWrap);
        const heading = collections.querySelector('h2'); heading ? collections.insertBefore(shell, heading.nextSibling) : collections.appendChild(shell);
        cardsCache.forEach(card => track.appendChild(card));

        prevBtn.addEventListener('click', ()=> goToIndex(index - 1, true));
        nextBtn.addEventListener('click', ()=> goToIndex(index + 1, true));
        viewport.addEventListener('scroll', onScroll, { passive: true });
        viewport.addEventListener('keydown', (e)=>{ if (e.key === 'ArrowRight') nextBtn.click(); if (e.key === 'ArrowLeft') prevBtn.click(); });

        ro = new ResizeObserver(()=>{ const oldPages = pages, oldSlots = slotsPerView, oldIndex = index; measure(); if (pages !== oldPages || slotsPerView !== oldSlots){ buildDots(); goToIndex(Math.min(oldIndex, pages - 1), false); } else { updateDots(); } updateArrows(); });
        ro.observe(viewport);

        requestAnimationFrame(()=>{ measure(); buildDots(); goToIndex(0, false); });
      }

      function disable(){ if (!shell) return; const anchor = shell; cardsCache.forEach(card=> collections.insertBefore(card, anchor)); ro?.disconnect(); shell.remove(); shell = viewport = track = prevBtn = nextBtn = dotsWrap = null; dots = []; cardsCache = []; index = 0; stepPx = 0; slotsPerView = 1; pages = 1; }

      function handle(){ mq.matches ? enable() : disable(); }
      handle(); mq.addEventListener('change', handle);
    })();

    // Footer year
    document.addEventListener('DOMContentLoaded', ()=>{
      const p = document.getElementById('copyright');
      const y = new Date().getFullYear();
      if (p) p.innerHTML = `&copy; ${y} Dream Agent. All rights reserved.`;
    });
  </script>
</body>
</html>
